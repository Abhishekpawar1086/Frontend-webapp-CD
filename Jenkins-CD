pipeline {
  agent any

  environment {
    GCP_PROJECT_ID = 'final-project-453412'
    GAR_REPO = 'us-central1-docker.pkg.dev/final-project-453412/docker-images'
    IMAGE_NAME = 'frontend-webapp'
    KUBE_NAMESPACE = 'frontend-app'
    GKE_CLUSTER = 'cluster-1-front-end-web-app'
    GKE_ZONE = 'us-central1'
    // HELM_CHART_PATH = 'path/to/your/helm/chart'
  }
stages {
  stage('Clean Workspace') {
      steps {
                cleanWs() // Cleans the workspace
            }
        }
  stage('Clone Repository') {
      steps {
          echo "Cloning repository..."
          git branch: 'main', credentialsId: 'Jenkins-token', url: 'https://github.com/Abhishekpawar1086/Frontend-webapp-CD.git'
        
      }
    }
  stage('Authenticate with GKE') {
      steps {
        withCredentials([file(credentialsId: 'gcp-artifact-registry-key', variable: 'GCP_KEY')]) {
          script {
            echo "Authenticating with GKE cluster..."
            sh """
              gcloud auth activate-service-account --key-file=${GCP_KEY}
              gcloud container clusters get-credentials ${GKE_CLUSTER} --zone ${GKE_ZONE} --project ${GCP_PROJECT_ID}
            """
        }
      }
    }
  }
stage('Deploy to GKE using Helm') {
            steps {
                script {
                    // Deploy the application using Helm  frontend-app name of your chart
                   sh "helm upgrade react-app ./ --set image_tag=${image_tag}"
                      // sh "helm install frontend-app ./ --set image_tag=${image_tag}"
                      

                }
            }
        }
 }
}
